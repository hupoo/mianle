<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>商品详情</title>
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0">
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#31ff99">
    <link rel="stylesheet" type="text/css" media="screen" href="./ydui/build/css/ydui.css" />
    <link rel="stylesheet" href="./css/goodsDetail.css">
    <link rel="stylesheet" href="./css/common.css">
    <script src="./ydui/build/js/ydui.flexible.js"></script>
    <style>
    </style>
</head>

<body>
    <section class="g-flexview">
        <header class="m-navbar">
            <a href="#" class="navbar-item">
                <i class="m-icon icon-left-light "></i>
            </a>
            <div class="navbar-center">
                <ul class="tab-nav border-no">
                    <li class="tab-nav-item tab-active">
                        <a href="javascript:;">商品</a>
                    </li>
                    <li class="tab-nav-item ">
                        <a href="javascript:;">详情</a>
                    </li>
                    <li class="tab-nav-item ">
                        <a href="javascript:;">评价</a>
                    </li>
                </ul>
            </div>
            <a href="#" class="navbar-item">
                <i class="icon-more"></i>
            </a>
        </header>
        <div class="g-scrollview border-no">


        </div>
        <!-- 底部工具栏 -->
        <footer class="m-tabbar padded-0">
            <a href="#" class="tabbar-item">
                <span class="tabbar-icon">
                    <i class="m-icon icon-talk-gray trans-14"></i>
                </span>
                <span class="tabbar-txt">客服</span>
            </a>
            <div class="tabbar-item" id="J_star">
                <span class="tabbar-icon">
                    <i class="m-icon icon-star-line trans-14"></i>
                </span>
                <span class="tabbar-txt">收藏</span>
            </div>
            <a href="./shopCar.html" class="tabbar-item">
                <span class="tabbar-icon">
                    <i class="m-icon icon-shopcar-gray trans-14"></i>
                    <span class="badge badge-danger">2</span>
                </span>
                <span class="tabbar-txt">购物车</span>
            </a>
            <a href="#" class="tabbar-item add flex-2" id="J_add">
                加入购物车
            </a>
            <a href="#" class="tabbar-item new bg-default flex-2" id="J_buy">
                立即购买
            </a>
        </footer>
    </section>
</body>
<!-- 遮罩 -->
<!-- 商品参数选择 -->
<div class="m-mask fadeDeatial g-flexview " id="J_fadeDetail">
    <div class="empty"></div>
    <div class="content flex-1">
        <article class="m-list list-theme4 bg-empty">
            <div class="list-item border-no">
                <div class="list-img">
                    <img src="http://img1.shikee.com/try/2016/06/19/09430120929215230041.jpg_180x180.jpg" data-url="http://img1.shikee.com/try/2016/06/19/09430120929215230041.jpg_180x180.jpg"
                        data-img>
                </div>
                <div class="list-mes bg-empty ">
                    <h3 class="list-title text-default margin-t-15">
                        <span>
                            <em>¥</em>34.7</span>
                    </h3>
                    <div class="list-mes-item padded-t-15">
                        <span class="text-gray font-size-12">
                            库存:
                            <em>20</em>件
                        </span>
                    </div>
                    <div class="list-mes-item margin-t-10">
                        请选择 颜色、尺码
                    </div>
                </div>
            </div>
            <i class="icon-error-outline font-size-18 text-gray js-close" id="J_close"></i>
        </article>
        <div class="box ">
            <div class="box-title font-size-16 ">
                颜色
            </div>
            <div class="rds-group">
                <label for="" class="rds-list-item">
                    <input type="radio" value="1" name="type1">
                    <span>黑色</span>
                </label>
                <label for="" class="rds-list-item">
                    <input type="radio" value="1" name="type1">
                    <span>黑色</span>
                </label>
                <label for="" class="rds-list-item">
                    <input type="radio" value="1" name="type1">
                    <span>黑色</span>
                </label>
            </div>
        </div>
        <div class="box ">
            <div class="box-title font-size-16 ">
                尺码
            </div>
            <div class="rds-group">
                <label for="" class="rds-list-item">
                    <input type="radio" value="1" name="type2">
                    <span>39码</span>
                </label>
                <label for="" class="rds-list-item">
                    <input type="radio" value="1" name="type2">
                    <span>39码</span>
                </label>
                <label for="" class="rds-list-item">
                    <input type="radio" value="1" name="type2">
                    <span>39码</span>
                </label>
            </div>
        </div>
        <div class="box ">
            <div class="box-title font-size-16 ">
                数量
            </div>
            <span class="m-spinner margin-t-15" data-ydui-spinner="{input: '.J_Input', add: '.J_Add', minus: '.J_Del'}">
                <!-- 添加data-ydui-spinner属性并添加参数即可 -->
                <a href="javascript:;" class="J_Del"></a>
                <input type="text" class="J_Input" data-num placeholder="" value="1" />
                <a href="javascript:;" class="J_Add"></a>
            </span>
        </div>
    </div>

    <footer class="m-tabbar  padded-0 ">
        <a href="#" class="tabbar-item add " id="J_chooseAdd">
            加入购物车
        </a>
        <a href="#" class="tabbar-item new bg-default ">
            立即购买
        </a>
    </footer>
</div>
<div class="m-mask flex-c-c " id="J_mask" style="display:none;">
    <div class="ercode-wrap">
        <img src="#" alt="二维码">
    </div>
</div>
<!-- ---------------------------------------------------------------------------------------- -->
<script src="./js/jquery.3.0.0.min.js"></script>
<script src="./js/addToCookie.js"></script>
<script src="./js/getdata.js"></script>
<script src="./ydui/build/js/ydui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js" type="text/javascript"></script>

<script type="text/x-handlebars-template" id="goodsData">
 {{#with this.result }}
    <div class="m-slider" id="J_Slider">
        <div class="slider-wrapper">
            {{#each this.goodsImages}}
            <div class="slider-item">
                <a href="#">
                    <img src="{{../imgURL }}{{ this }}">
                </a>
            </div>
           {{/each}} 
        </div>
        <div class="slider-pagination"></div>
        <!-- 商品二维码 -->
        <div class="fade-ercode flex-c-c" id="J_ercode">
            <i class="iconfont icon-ercode trans-15"></i>
        </div>
        <!-- 分页标识 -->
    </div>
    <!-- 价格详情 -->
    <div class="price-detail">
        <div class="list-mes">
            <h3 class="list-title less-2 pro-title" data-shop-id="{{ businessId }}" data-pro-id="0002">
              {{goodsName}}
            </h3>
            <div class="list-mes-item margin-tb-15">
                <div>
                    <span class="text-default font-size-18  ">
                        ¥
                        <em class="f-weight-600 " data-price>{{goodsShopPrice}}</em>
                    </span>
                    <span class="list-del-price">¥{{ goodsMarketPrice}}</span>
                </div>
                <div class="font-size-12">
                    库存: {{goodsNumber}} 件
                </div>
            </div>
            <div class="list-mes-item padded-t-5">
                <div class="font-size-12 text-default">商品参与免单日可免单
                    <em>¥</em>
                    <span>34.7</span>
                </div>
            </div>
        </div>
    </div>
    <div class="m-cell bg-empty param">
        <div class="cell-item border-no">
            <div class="cell-left text-gray font-size-12">
                <i class="m-icon icon-success-fill-defalt"></i>免运费</div>
        </div>
        <div class="cell-item  " id="J_select">
            <div class="cell-left font-size-14">
                请选择 {{#each attrMap}} {{@key}} {{/each}}
            </div>
            <div class="cell-right cell-arrow">
            </div>
        </div>
    
    </div>
    <!-- 店铺详情 -->
    <div class="shopDetail m-list list-theme4">
        <div class="list-item border-no">
            <div class="list-img">
                <img src="#" alt="">
            </div>
            <div class="list-mes">
                <h3 class="list-title">{{ businessName }}</h3>
                <div class="list-mes-item padded-t-15 text-gray font-size-12">
                    <div>
                        <span>初级店铺</span>
                        <span>电话: {{ businessTel }}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="list-item flex-c-around">
            <a href="javascript:;" class="btn  font-size-16" pixel-border="all">
                <i class="m-icon icon-like-red"></i>
                收藏店铺</a>
            <a href="javascript:;" class="btn  font-size-16" pixel-border="all">
                <i class="m-icon icon-shop-default"></i>
                进入店铺</a>
        </div>
    </div>
    
    <div class="recommend-content goodsdetail ">
        <div class="recommenf-title  bg-empty">
            商品详情
        </div>
    </div>
    <div class="m-tab goodsinfo " id="J_Tab">
        <div class="m-grids-3 " id="J_top">
            <div class="grids-item tab-active">
                <div class="grids-txt">
                    <span>商品介绍</span>
                </div>
            </div>
            <div class="grids-item">
                <div class="grids-txt">
                    <span>规格参数</span>
                </div>
            </div>
            <div class="grids-item">
                <div class="grids-txt">
                    <span>评价</span>
                </div>
            </div>
        </div>
        <div class="tab-panel">
            <div class="tab-panel-item tab-active">
                {{#if commentList }}
                <div class="m-cell evaluate margin-b-0 ">
                    <div class="m-celltitle">
                        评价(3)
                    </div>
                    {{#each commentList}}
                    <div class="evaluateinfo border-b">
                        <div class="cell-item border-no">
                            <div class="cell-left">
                                <span class="cell-icon  font-size-16">
                                    <img src="http://static.ydcss.com/ydui/img/logo.png" class="img-round vator" />
                                </span>{{userName}}</div>
                            <div class="cell-right text-gray font-size-10">
                                {{commentTime}}
                            </div>
                        </div>
                        <a href="" class="info">
                            <p class="star {{ range  }}"></p>
                            <div class="text">
                               {{commentContent}}
                            </div>
                        </a>
                        <div class="img-wrap">
                            {{#imgstoArr commentImgs }}
                             {{/imgstoArr}}
                        </div>
                    </div>
                    {{/each}}
                    <div class="cell-item checkmore flex-c-c">
                        <button class="btn all-comment" pixel-border="all">
                            查看全部评价 &gt;
                        </button>
                    </div>
                </div>
                {{else}} 
                <div class="no-view flex-c-c flex-column ">
                    <div class="content ">
                        <img src="./img/no_evaluate.png" alt="">
                    </div>
                    <div class=" text-gray font-size-14 text-center">
                        暂时没有评论哦~
                    </div>
                </div>
              {{/if}}
                <div class="detail-img-contianer">
                    {{{goodsIntroduce }}}
                    <!-- 详情图片 -->
                    <!-- <img src="http://img10.360buyimg.com/imgzone/jfs/t15784/206/2184693919/89464/9f204be2/5a961b04Nc37367d0.jpg"> -->
                </div>
            </div>
            <div class="tab-panel-item">
                {{{goodsStandard}}}
                <!-- <table class="table-border" width="100%">
                    <tbody>
                    </tbody>
                </table> -->
            </div>
            <div class="tab-panel-item bg-gray">
    
                <div class="goodRate border-b">
                    好评率:
                    <span>98</span>%
                </div>
                <div class="rds-group detail flex-c flex-c-between">
                    <label for="" class="rds-list-item">
                        <input type="radio" value="1" name="type1" checked>
                        <span pixel-border="all">全部
                            <em>0</em>
                        </span>
                    </label>
                    <label for="" class="rds-list-item">
                        <input type="radio" value="1" name="type1">
                        <span pixel-border="all">好评
                            <em>0</em>
                        </span>
                    </label>
                    <label for="" class="rds-list-item">
                        <input type="radio" value="1" name="type1">
                        <span pixel-border="all">中评
                            <em>0</em>
                        </span>
                    </label>
                    <label for="" class="rds-list-item">
                        <input type="radio" value="1" name="type1">
                        <span pixel-border="all">差评
                            <em>0</em>
                        </span>
                    </label>
                </div>
                <div class="evaluate detail">
                    <div class="evaluateinfo border-b">
                        <div class="cell-item border-no">
                            <div class="cell-left">
                                <span class="cell-icon  font-size-16">
                                    <img src="http://static.ydcss.com/ydui/img/logo.png" class="img-round vator" />
                                </span>用户名</div>
                            <div class="cell-right text-gray font-size-10">
                                2018-01-09 15:56:21
                            </div>
                        </div>
                        <div class="info">
                            <p>
                                <span class="star five">
                                </span>
                                <a href="#" class="btn btn-reply fr">回复</a>
                            </p>
                            <div class="text">
                                <em>商家回复：</em>
                                <span>
                                    感谢您的喜欢，
                                </span>
                            </div>
                            <div class="img-wrap">
                                <div class="img-wrap-item">
                                    <img src="http://static.ydcss.com/uploads/ydui/2.jpg" alt="">
                                </div>
                                <div class="img-wrap-item">
                                    <img src="http://static.ydcss.com/uploads/ydui/2.jpg" alt="">
                                </div>
                                <div class="img-wrap-item">
                                    <img src="http://static.ydcss.com/uploads/ydui/2.jpg" alt="">
                                </div>
                                <div class="img-wrap-item">
                                    <img src="http://static.ydcss.com/uploads/ydui/2.jpg" alt="">
                                </div>
    
                            </div>
    
                            <div class="shop-reply ">
                                <em>商家回复：</em>
                                <span>
                                    感谢您的喜欢，
                                </span>
                            </div>
                            <p class="msg-count flex-c flex-end">
                                <i class="m-icon icon-msg-gray "></i>
                                <span class="count">15</span>
                            </p>
                        </div>
                    </div>
                    <div class="evaluateinfo border-b">
                        <div class="cell-item border-no">
                            <div class="cell-left">
                                <span class="cell-icon  font-size-16">
                                    <img src="http://static.ydcss.com/ydui/img/logo.png" class="img-round vator" />
                                </span>用户名</div>
                            <div class="cell-right text-gray font-size-10">
                                2018-01-09 15:56:21
                            </div>
                        </div>
                        <div class="info">
                            <p>
                                <span class="star five">
                                </span>
                                <a href="#" class="btn btn-reply fr">回复</a>
                            </p>
                            <div class="text">
                                可以好评不错 喜欢！
                            </div>
                            <div class="img-wrap">
                                <div class="img-wrap-item">
                                    <img src="http://static.ydcss.com/uploads/ydui/2.jpg" alt="">
                                </div>
                                <div class="img-wrap-item">
                                    <img src="http://static.ydcss.com/uploads/ydui/2.jpg" alt="">
                                </div>
                                <div class="img-wrap-item">
                                    <img src="http://static.ydcss.com/uploads/ydui/2.jpg" alt="">
                                </div>
                                <div class="img-wrap-item">
                                    <img src="http://static.ydcss.com/uploads/ydui/2.jpg" alt="">
                                </div>
    
                            </div>
    
                            <div class="shop-reply ">
                                <em>商家回复：</em>
                                <span>
                                    感谢您的喜欢，
                                </span>
                            </div>
                            <p class="msg-count flex-c flex-end">
                                <i class="m-icon icon-msg-gray "></i>
                                <span class="count">15</span>
                            </p>
                        </div>
                    </div>
                </div>
    
            </div>
        </div>
    </div>
    <div class="backTo">
    </div>
    {{/with}}
</script>
<script type="text/x-handlebars-template" id="content">
            {{#with this.result}}
        <article class="m-list list-theme4 bg-empty">
            <div class="list-item border-no">
                <div class="list-img">
                    <img src="http://img1.shikee.com/try/2016/06/19/09430120929215230041.jpg_180x180.jpg" data-url="http://img1.shikee.com/try/2016/06/19/09430120929215230041.jpg_180x180.jpg"
                        data-img>
                </div>
                <div class="list-mes bg-empty ">
                    <h3 class="list-title text-default margin-t-15">
                        <span>
                            <em>¥</em>{{goodsShopPrice}}</span>
                    </h3>
                    <div class="list-mes-item padded-t-15">
                        <span class="text-gray font-size-12">
                            库存:
                            <em>{{goodsNumber}}</em>件
                        </span>
                    </div>
                    <div class="list-mes-item margin-t-10">
                        请选择  {{#each attrMap}}
                         {{@key}}
                         {{/each}}
                         </div>
                    </div>
                </div>
            </div>
            <i class="icon-error-outline font-size-18 text-gray js-close" id="J_close"></i>
        </article>
        {{#each attrMap}}
        <div class="box ">
            <div class="box-title font-size-16 ">
                {{@key}}
            </div>
            <div class="rds-group">
                {{#each this}}
                <label for="" class="rds-list-item">
                    <input type="radio" value="{{@index}}" name="type{{@../index }}">
                    <span>{{this}}</span>
                </label>
                {{/each}}
              
            </div>
        </div>
        {{/each}}
        <div class="box ">
            <div class="box-title font-size-16 ">
                数量
            </div>
            <span class="m-spinner margin-t-15" data-ydui-spinner="{input: '.J_Input', add: '.J_Add', minus: '.J_Del'}">
                <!-- 添加data-ydui-spinner属性并添加参数即可 -->
                <a href="javascript:;" class="J_Del"></a>
                <input type="text" class="J_Input" data-num placeholder="" value="1" />
                <a href="javascript:;" class="J_Add"></a>
            </span>
        </div>
        {{/with}}
</script>
<script>
    var t = $('#goodsData').html();
    var f = Handlebars.compile(t);
    var t1 = $('#content').html();
    var f1 = Handlebars.compile(t1);
    //商品详情
    MLM.goodsDetailData(21, function (ret) {
        ret.result.imgURL = config.IMGURL;
        var d = f(ret);
        var d1 = f1(ret);
        console.log(ret)
        $('.g-scrollview').html(d);
        $('.content').html(d1);
    });


    // 评论图片循环
    Handlebars.registerHelper('imgstoArr', function (str, options) {
        var arr = [];
        if (str.indexOf("|") != -1)  arr = str.split("|");
        else  arr.push(str);
        var img = '';
        for (let i = 0; i < arr.length; i++) {
            img += `<div class="img-wrap-item"><img src="${config.IMGURL}${arr[i]}" alt=""></div>`;
        }
        return img;
    })


    jsonObj = {
        pageNum: 1,
        pageSize: 10,
        goodsId: 1,
        commentType: 1,
    }
    // 评论获取
    MLM.goodsCommentsData(jsonObj,function(ret){
        console.log(ret)
    });  

    $(function () {
        $('#J_Slider').slider({
            speed: 200,
            autoplay: 5000,
            lazyLoad: true
        });
        var dialog = window.YDUI.dialog;
        // 商品轮播

        // 商品二维显示隐藏
        $('#J_ercode').on('click', function () {
            $('#J_mask').fadeIn('fast');
        });
        $('#J_mask').on('click', function (e) {
            if (!$(e.target).is($('.ercode-wrap'))) {
                $(this).fadeOut('fast');
            }
        });
        // 商品选择
        $('#J_select').on('click', function () {
            $('#J_fadeDetail').addClass('slideIn');
        });
        $('.empty , #J_close').on('click', function () {
            $('#J_fadeDetail').removeClass('slideIn');
        });
        // 顶部点击切换关联
        $('.tab-nav-item').on('click', function () {
            var index = $(this).index();
            $(this).addClass('tab-active').siblings().removeClass('tab-active');
            switch (index) {
                case 0:
                    // 回滚顶部
                    $('.g-scrollview').animate({ scrollTop: 0 }, 300);
                    //初始化
                    $('.grids-item').eq(0).addClass('tab-active').siblings().removeClass('tab-active');
                    $('.tab-panel-item').eq(0).addClass('tab-active').siblings().removeClass('tab-active');
                    break;
                case 1:
                    $('.grids-item').eq(0).addClass('tab-active').siblings().removeClass('tab-active');
                    $('.tab-panel-item').eq(0).addClass('tab-active').siblings().removeClass('tab-active');
                    console.log(sTop)
                    isScroll();
                    break;
                default:
                    $('.grids-item').eq(2).addClass('tab-active').siblings().removeClass('tab-active');
                    $('.tab-panel-item').eq(2).addClass('tab-active').siblings().removeClass('tab-active');
                    isScroll()
                    break;
            }
        });
        // 详情点击切换
        $('.grids-item').on('click', function () {
            var index = $(this).index();
            $(this).addClass('tab-active').siblings().removeClass('tab-active');
            $('.tab-panel-item').eq(index).addClass('tab-active').siblings().removeClass('tab-active');
            switch (index) {
                case 0:
                    $('.tab-nav-item').eq(1).addClass('tab-active').siblings().removeClass('tab-active');
                    isScroll();

                    break;
                case 1:
                    $('.tab-nav-item').eq(1).addClass('tab-active').siblings().removeClass('tab-active');
                    isScroll()

                    break;
                default:
                    $('.tab-nav-item').eq(2).addClass('tab-active').siblings().removeClass('tab-active');
                    isScroll()

                    break;
            }
        });

        // 是否触发返回顶部
        $('.g-scrollview').on('scroll', function () {
            setTop();
            if ($(this).scrollTop() > 500)
                $(".backTo").fadeIn(500);
            else $(".backTo").fadeOut(500);
        });

        // 返回顶部触发
        $("body").on('click', '.backTo', function () {
            $('.g-scrollview').animate({ scrollTop: 0 }, 300);
        });

        // 是否滚动
        function isScroll() {
            var istop = $('#J_top').position().top == 0 ? false : true;
            if (istop) $('.g-scrollview').animate({ scrollTop: sTop }, 300);
        }
        // 是否滚动开关
        var sTop,
            setTop = function () {
                if ($('.g-scrollview').scrollTop() == 0) {
                    sTop = $('#J_top').position().top;
                }
            };
        setTop();
        // 收藏
        var flag = true;
        $('body').on('click', '#J_star', function () {
            collect(flag);
            // dosomthing....
        });
        $('body').on('click', '#J_add', function () {
            addToShopCar();
            // dosomthing....
        });
        $('body').on('click', '#J_chooseAdd', function () {

            var products = {
                shop_id: $('h3.pro-title').attr('data-shop-id'),
                name: $('h3.pro-title').text(),
                pro_id: $('h3.pro-title').attr('data-pro-id'),
                img: $('img[data-img]').attr('src'),
                price: $('em[data-price]').text(),
                num: $('input[data-num]').val(),
            };

            cart.addProduct(products);
            dialog.toast('添加成功', 'none', 1000);
        });


        function addToShopCar() {
            $('#J_fadeDetail').addClass('slideIn');
        }
        function collect(params) {
            $('#J_star').find('i').toggleClass('icon-star-fill');
            if (flag) {
                $('#J_star').find('.tabbar-txt').text('已收藏');
                flag = false;
            }
            else {
                $('#J_star').find('.tabbar-txt').text('收藏');
                flag = true;
            }
        }
        // 查看所有评价
        $('.all-comment').on('click', function () {
            $('.grids-item').eq(2).addClass('tab-active').siblings().removeClass('tab-active');
            $('.tab-nav-item').eq(2).addClass('tab-active').siblings().removeClass('tab-active');
            $('.tab-panel-item').eq(2).addClass('tab-active').siblings().removeClass('tab-active');
            isScroll()
        })
    })

</script>

</html>